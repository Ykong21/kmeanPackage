% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/KernalResample.R
\name{kr_boot_plus}
\alias{kr_boot_plus}
\title{KernelReSample}
\usage{
kr_boot_plus(
  N,
  n,
  B,
  x,
  y,
  x0s,
  y0s,
  lambda0,
  kernel = c("gaussian", "laplace", "matern"),
  matern_nu = c(0.5, 1.5, 2.5),
  clustering = c("kmeans", "kmeans_pp", "kmeans_rp", "kmedoids"),
  n_centers = n,
  kmeans_maxiter = 50,
  rp_dim = 24,
  bw_centers_method = c("median", "detcov"),
  bw_scope = c("centers", "train_sample"),
  bw_train_sample = 2000,
  tune_bw = FALSE,
  bw_scales = c(0.25, 0.5, 1, 2),
  bw_subset_method = c("median", "detcov"),
  joint_tune = FALSE,
  verbose = FALSE
)
}
\arguments{
\item{N}{Integer. Number of training points (must equal nrow(x)).}

\item{n}{Integer. Bootstrap resample size per draw.}

\item{B}{Integer. Number of bootstrap draws.}

\item{x}{Matrix. Training covariates (N x p).}

\item{y}{Numeric. Training responses (length N).}

\item{x0s}{Matrix. Test covariates (m x p).}

\item{y0s}{Numeric. Test responses (length m), used only for MSE reporting.}

\item{lambda0}{Numeric vector. Candidate lambdas for BIC tuning on centers.}

\item{kernel}{Kernel family: "gaussian" (default), "laplace", "matern".}

\item{matern_nu}{Matern smoothness: 0.5, 1.5, or 2.5 (only used if kernel="matern").}

\item{clustering}{Clustering for centers: "kmeans" (default), "kmeans_pp",
"kmeans_rp", or "kmedoids".}

\item{n_centers}{Integer. Number of centers/clusters used for selection weights (default = n).}

\item{kmeans_maxiter}{Integer. Max iterations for kmeans backends.}

\item{rp_dim}{Integer. Random projection dimension for "kmeans_rp".}

\item{bw_centers_method}{Bandwidth rule for \emph{centers} (selection weights):
"detcov" (default) or "median".}

\item{bw_scope}{Scope for centers bandwidth when bw_centers_method is used:
"centers" (default) uses centers; "train_sample" uses a subsample of X.}

\item{bw_train_sample}{Integer. Subsample size if bw_scope="train_sample".}

\item{tune_bw}{Logical. If TRUE, allow bw_scales for centers bandwidth.}

\item{bw_scales}{Numeric. Multiplicative scales applied to centers bandwidth in tuning.}

\item{bw_subset_method}{Bandwidth rule for \emph{subset} bandwidth on each bootstrap resample:
"detcov" (default) or "median".}

\item{joint_tune}{Logical. If TRUE and tune_bw=TRUE, joint tune (bw_scale, lambda) by BIC.
If FALSE (default), tune lambda only (bw fixed at base value).}

\item{verbose}{Logical. Print progress messages.}
}
\value{
A list with fields:
\itemize{
\item y0s, est (m x 1), MSE (length m), Ave_MSE
\item lambda_opt, bw_centers, bw_centers_method, bw_subset_method
\item clustering, kernel, matern_nu (if applicable)
\item timing (named list of elapsed seconds)
}
}
\description{
Advanced kernel resampling estimator.
Provides configurable (i) clustering to build selection weights and
(ii) kernel family + bandwidth rules for both center-stage selection and
bootstrap-resample KRR estimation.
}
\details{
Key design
\itemize{
\item Compute centers once (clustering on full training X).
\item Compute a center-stage bandwidth (rho/ell) for \emph{selection weights} only.
\item Tune lambda by default (BIC on centers); optionally joint tune (bw_scale, lambda).
\item For each test point x0: compute sampling probs using centers.
\item For each bootstrap draw: resample indices with replacement and recompute
the \emph{subset} bandwidth on that resample, then do accurate KRR via Cholesky.
}

Bandwidth units are handled cleanly by kernel type:
\itemize{
\item Gaussian: exp(-||x-y||^2 / rho)     -> rho is squared-distance scale
\item Laplace:  exp(-||x-y|| / ell)       -> ell is distance scale
\item Matern:   uses distance/ell         -> ell is distance scale
}
}
\examples{
set.seed(1)
N <- 2000
p <- 3
x <- matrix(rnorm(N * p), N, p)
y <- x[, 1] - 2 * x[, 2] + rnorm(N)
x0s <- matrix(rnorm(10 * p), 10, p)
y0s <- x0s[, 1] - 2 * x0s[, 2]
lambda0 <- 10^seq(-2, 2, length.out = 10)
out <- kr_boot_plus(
  N = N, n = 200, B = 5,
  x = x, y = y,
  x0s = x0s, y0s = y0s,
  lambda0 = lambda0,
  kernel = "gaussian",
  bw_centers_method = "median",
  bw_subset_method = "median"
)
out$Ave_MSE

}
